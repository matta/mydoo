# yaml-language-server: $schema=../schemas/feature.schema.json
feature: Lead Time Inheritance
description:
  'Verify that children inherit lead time correctly and use it for their own
  readiness calculation'

background:
  current_time: '2023-01-01T12:00:00Z'
  tasks:
    - id: 'parent-1'
      title: 'Parent Future Task'
      status: 'Pending'
      importance: 1.0
      due_date: '2023-01-11T12:00:00Z' # 10 days from now
      lead_time_seconds: 86400 # 1 day lead time
      children:
        - id: 'child-1'
          title: 'Child Task'
          status: 'Pending'
          importance: 1.0

scenarios:
  - name: 'Verify Inheritance'
    steps:
      - then:
          expected_order: []
          expected_props:
            - id: 'parent-1'
              score: 0.0
              is_ready: false
            - id: 'child-1'
              score: 0.0
              is_ready: false

  - name: 'Verify Readiness after lead time'
    steps:
      - when:
          # Advance 9 days (still 1 day before due date, so should be ready now with 1 day lead time)
          advance_time_seconds: 777600 # 9 days
      - then:
          expected_props:
            - id: 'parent-1'
              is_ready: true
            - id: 'child-1'
              is_ready: true

  - name: 'Variable Lead Times'
    steps:
      - given:
          tasks:
            - id: 'parent-1'
              lead_time_seconds: ${lead_time}
      - when:
          advance_time_seconds: ${wait_time}
      - then:
          expected_props:
            - id: 'parent-1'
              is_ready: ${expected_ready}
    examples:
      - {lead_time: 86400, wait_time: 0, expected_ready: false}
      - {lead_time: 86400, wait_time: 864000, expected_ready: true} # 10 days
      - {lead_time: 0, wait_time: 0, expected_ready: false}
