# yaml-language-server: $schema=../schemas/test_case.schema.json
name: Visibility Logic
description: >
  Tests complex visibility logic involving Place contexts, Operating Hours, and
  'Included In' hierarchy. Verifies tasks are hidden when their Place is closed
  or filtered out.
initial_state:
  current_time: '2025-01-01T09:00:00Z'
  places:
    - id: Home
      hours:
        mode: always_open
      included_places: []
    - id: Office
      hours:
        mode: custom
        schedule:
          Mon:
            - 09:00-17:00
          Tue:
            - 09:00-17:00
          Wed:
            - 09:00-17:00
          Thu:
            - 09:00-17:00
          Fri:
            - 09:00-17:00
      included_places:
        - Desk
    - id: Desk
      hours:
        mode: always_open
      included_places: []
  tasks:
    - id: GlobalTask
      title: Task Anywhere
      status: Pending
      importance: 1.0
      desired_credits: 0.0
      place_id: Anywhere
    - id: HomeTask
      title: Task Home
      status: Pending
      importance: 1.0
      desired_credits: 0.0
      place_id: Home
    - id: OfficeTask
      title: Task Office
      status: Pending
      importance: 1.0
      desired_credits: 0.0
      place_id: Office
    - id: DeskTask
      title: Task Desk
      status: Pending
      importance: 1.0
      desired_credits: 0.0
      place_id: Desk
steps:
  - name: 'Filter: All Places (Office Open)'
    view_filter: All Places
    expected_order:
      - GlobalTask
      - HomeTask
      - OfficeTask
      - DeskTask
    expected_props:
      - id: GlobalTask
        score: 1.0
      - id: HomeTask
        score: 1.0
      - id: OfficeTask
        score: 1.0
      - id: DeskTask
        score: 1.0
  - name: 'Filter: Home'
    view_filter: Home
    expected_order:
      - GlobalTask
      - HomeTask
    expected_props:
      - id: GlobalTask
        score: 1.0
      - id: HomeTask
        score: 1.0
      - id: OfficeTask
        is_visible: false
      - id: DeskTask
        is_visible: false
  - name: 'Filter: Office'
    view_filter: Office
    expected_order:
      - GlobalTask
      - OfficeTask
      - DeskTask
    expected_props:
      - id: GlobalTask
        score: 1.0
      - id: HomeTask
        score: 0.0
      - id: OfficeTask
        score: 1.0
      - id: DeskTask
        score: 1.0
  - name: Advance to Closed Time (Office closes at 17:00)
    view_filter: Office
    mutation:
      advance_time_seconds: 32400
    expected_order:
      - GlobalTask
      - DeskTask
    expected_props:
      - id: OfficeTask
        score: 0.0
      - id: GlobalTask
        score: 1.0
      - id: DeskTask
        score: 1.0
  - name: 'Filter: All Places (Office Closed)'
    view_filter: All Places
    expected_order:
      - GlobalTask
      - HomeTask
      - DeskTask
    expected_props:
      - id: OfficeTask
        score: 0.0
      - id: HomeTask
        score: 1.0
      - id: DeskTask
        score: 1.0
