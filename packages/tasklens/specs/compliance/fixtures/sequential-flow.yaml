# yaml-language-server: $schema=../schemas/test-case.schema.json
name: Sequential Blocking
description:
  Verify that in a sequential group, only the first pending task is active
  (visible), and subsequent tasks are blocked.

initial_state:
  current_time: '2023-01-01T12:00:00+00:00'
  timezone_offset: 0
  tasks:
    - id: Group
      title: Sequential Group
      status: Pending
      is_sequential: true
      children:
        - id: Step_A
          title: First Step
          status: Pending
        - id: Step_B
          title: Second Step
          status: Pending
        - id: Step_C
          title: Third Step
          status: Pending

steps:
  - name: Initial State - Step A Active
    expected_order: ['Step_A']
    expected_props:
      - id: Step_A
        score: 1.0
        is_ready: true
        is_visible: true
      - id: Step_B
        score: 0.0
        is_ready: false
        is_visible: true
      - id: Step_C
        is_ready: false
        is_visible: true

  - name: Complete Step A
    mutation:
      task_updates:
        - id: Step_A
          status: Done
          is_acknowledged: true
    expected_order: ['Step_B']
    expected_props:
      - id: Step_A
        score: 1.0 # Completed, but score remains high (just filtered out)
        is_visible: true
      - id: Step_B
        score: 1.0 # Unblocked!
        is_ready: true
        is_visible: true
      - id: Step_C
        is_ready: false
        is_visible: true

  - name: Complete Step B
    mutation:
      task_updates:
        - id: Step_B
          status: Done
          is_acknowledged: true
    expected_order: ['Step_C']
    expected_props:
      - id: Step_B
        is_visible: true
      - id: Step_C
        is_ready: true
        is_visible: true
