try{importScripts("version.js");}catch(e){console.warn("version.js missing",e);}function getVersion(){const v=self.__TODO_MVP_BUILD_VERSION__;return typeof v==="string"?v:"unknown";}const LOG_DB_NAME="TodoMVPLogs";const LOG_STORE_NAME="logs";function logToIDB(type,message){const version=getVersion();console.log(`[SW v${version}][${type}] ${message}`);const request=indexedDB.open(LOG_DB_NAME,1);request.onupgradeneeded=event=>{const db=event.target.result;if(!db.objectStoreNames.contains(LOG_STORE_NAME)){db.createObjectStore(LOG_STORE_NAME,{keyPath:"id",autoIncrement:true});}};request.onsuccess=event=>{const db=event.target.result;try{const transaction=db.transaction(LOG_STORE_NAME,"readwrite");const store=transaction.objectStore(LOG_STORE_NAME);const addRequest=store.add({timestamp:new Date().toISOString(),version:getVersion(),type:type,message:message});addRequest.onerror=e=>{console.error("Failed to add log entry:",e.target.error);};}catch(e){console.error("Failed to write log to IDB:",e);}};request.onerror=e=>{console.error("IDB Error:",e.target.error);};}self.addEventListener("install",_event=>{const version=getVersion();const msg=`Installing Service Worker v${version}`;logToIDB("install",msg);self.skipWaiting();});self.addEventListener("activate",event=>{const msg=`Service Worker v${getVersion()} is now ACTIVE`;logToIDB("activate",msg);event.waitUntil(self.clients.claim());});