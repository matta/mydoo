{
  "feature": "Visibility Logic",
  "description": "Tests complex visibility logic involving Place contexts, Operating Hours, and 'Included In' hierarchy. Verifies tasks are hidden when their Place is closed or filtered out.\n",
  "background": {
    "current_time": "2025-01-01T09:00:00Z",
    "places": [
      {
        "id": "Home",
        "hours": {
          "mode": "always_open"
        },
        "included_places": []
      },
      {
        "id": "Office",
        "hours": {
          "mode": "custom",
          "schedule": {
            "Mon": [
              "09:00-17:00"
            ],
            "Tue": [
              "09:00-17:00"
            ],
            "Wed": [
              "09:00-17:00"
            ],
            "Thu": [
              "09:00-17:00"
            ],
            "Fri": [
              "09:00-17:00"
            ]
          }
        },
        "included_places": [
          "Desk"
        ]
      },
      {
        "id": "Desk",
        "hours": {
          "mode": "always_open"
        },
        "included_places": []
      }
    ],
    "tasks": [
      {
        "id": "GlobalTask",
        "title": "Task Anywhere",
        "status": "Pending",
        "importance": 1,
        "desired_credits": 0,
        "place_id": "Anywhere"
      },
      {
        "id": "HomeTask",
        "title": "Task Home",
        "status": "Pending",
        "importance": 1,
        "desired_credits": 0,
        "place_id": "Home"
      },
      {
        "id": "OfficeTask",
        "title": "Task Office",
        "status": "Pending",
        "importance": 1,
        "desired_credits": 0,
        "place_id": "Office"
      },
      {
        "id": "DeskTask",
        "title": "Task Desk",
        "status": "Pending",
        "importance": 1,
        "desired_credits": 0,
        "place_id": "Desk"
      }
    ]
  },
  "scenarios": [
    {
      "name": "Legacy Scenario",
      "steps": [
        {
          "view_filter": "All Places",
          "legacy_description": "Filter: All Places (Office Open)",
          "then": {
            "expected_order": [
              "GlobalTask",
              "HomeTask",
              "OfficeTask",
              "DeskTask"
            ],
            "expected_props": [
              {
                "id": "GlobalTask",
                "score": 1
              },
              {
                "id": "HomeTask",
                "score": 1
              },
              {
                "id": "OfficeTask",
                "score": 1
              },
              {
                "id": "DeskTask",
                "score": 1
              }
            ]
          }
        },
        {
          "view_filter": "Home",
          "legacy_description": "Filter: Home",
          "then": {
            "expected_order": [
              "GlobalTask",
              "HomeTask"
            ],
            "expected_props": [
              {
                "id": "GlobalTask",
                "score": 1
              },
              {
                "id": "HomeTask",
                "score": 1
              },
              {
                "id": "OfficeTask",
                "is_visible": false
              },
              {
                "id": "DeskTask",
                "is_visible": false
              }
            ]
          }
        },
        {
          "view_filter": "Office",
          "legacy_description": "Filter: Office",
          "then": {
            "expected_order": [
              "GlobalTask",
              "OfficeTask",
              "DeskTask"
            ],
            "expected_props": [
              {
                "id": "GlobalTask",
                "score": 1
              },
              {
                "id": "HomeTask",
                "score": 0
              },
              {
                "id": "OfficeTask",
                "score": 1
              },
              {
                "id": "DeskTask",
                "score": 1
              }
            ]
          }
        },
        {
          "view_filter": "Office",
          "when": [
            {
              "increment_current_time": 32400
            }
          ],
          "legacy_description": "Advance to Closed Time (Office closes at 17:00)",
          "then": {
            "expected_order": [
              "GlobalTask",
              "DeskTask"
            ],
            "expected_props": [
              {
                "id": "OfficeTask",
                "score": 0
              },
              {
                "id": "GlobalTask",
                "score": 1
              },
              {
                "id": "DeskTask",
                "score": 1
              }
            ]
          }
        },
        {
          "view_filter": "All Places",
          "legacy_description": "Filter: All Places (Office Closed)",
          "then": {
            "expected_order": [
              "GlobalTask",
              "HomeTask",
              "DeskTask"
            ],
            "expected_props": [
              {
                "id": "OfficeTask",
                "score": 0
              },
              {
                "id": "HomeTask",
                "score": 1
              },
              {
                "id": "DeskTask",
                "score": 1
              }
            ]
          }
        }
      ]
    }
  ]
}
