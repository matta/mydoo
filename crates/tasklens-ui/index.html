<!--
  CUSTOM INDEX.HTML OVERRIDE

  Origin: This file is based on the default `dev.index.html` template from the
  Dioxus CLI repository.

  Reason for Existence: We are using a custom `index.html` because the current
  version of the `dx` CLI (0.6.x/0.7.x) ignores the `head` key within the
  `[web.app]` table in `Dioxus.toml`. This prevents us from automatically
  injecting critical PWA meta tags (manifest, theme-color, apple-touch-icon,
  etc.) during the build process.

  Rationale for "Dev" Template Base: `dx` forces a binary choice: use the
  default templates OR use a custom `index.html`. It does not support
  inheritance or partial injection.
  - The "Dev" template includes JavaScript logic for Hot-Reload Toasts (the
    "Rebuilding..." notifications).
  - The "Prod" template does not.
  - We chose to base our custom file on the "Dev" template so we preserve the
    developer experience (toasts) during local development. The trade-off is
    that this toast logic (~5KB of dead code) is shipped to production, but it
    remains dormant.

  Future Improvements (Feedback for Dioxus Team): This manual override could be
  avoided if `dx`:
  1. Respectfully parsed and injected the `head` key within the `[web.app]`
     table from `Dioxus.toml`.
  2. Supported profile-specific overrides (e.g., `dev.index.html` vs
     `prod.index.html` in the project root).
  3. Supported "partial" injection (e.g., a `head.html` fragment) to avoid
     forking the entire template.
  4. Supported injection of the dx "toast" logic into the user's custom
     `index.html`.
-->
<!doctype html>
<html>
  <head>
    <title>TaskLens</title>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
    <!-- Viewport Configuration -->
    <!-- width=device-width, initial-scale=1.0: Standard mobile responsiveness -->
    <!-- viewport-fit=cover: Extends the UI into the "notch" and home indicator areas on modern iPhones -->
    <!-- (requires using env(safe-area-inset-*) in CSS) -->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />

    <!-- iOS Standalone Mode (PWA) -->
    <!-- mobile-web-app-capable=yes: The modern standard for "standalone" mode -->
    <meta name="mobile-web-app-capable" content="yes" />

    <!-- iOS Status Bar Appearance -->
    <!-- apple-mobile-web-app-status-bar-style=black-translucent: Makes the status bar transparent, -->
    <!-- overlaying it on the app's background content. Combined with viewport-fit=cover, this -->
    <!-- creates a full-screen immersive feel. -->
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />

    <!-- iOS Home Screen Icon -->
    <!-- apple-touch-icon: The icon used when adding the app to the Home Screen. -->
    <!-- (User must ensure public/icon.png exists) -->
    <link rel="apple-touch-icon" href="icon.png" />

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" href="favicon.ico" />
    <!--
      Safe PWA Registration Glue
      Must be loaded before the WASM app so the `registerPwaSafe` function
      is available in the global scope when Rust calls it.
    -->
    <script src="pwa-glue.js"></script>

    <!-- Dynamic Theme Colors -->
    <!-- Light Mode: Matches --color-stone-50 (#fafaf9) -->
    <meta
      name="theme-color"
      content="#fafaf9"
      media="(prefers-color-scheme: light)"
    />
    <!-- Dark Mode: Matches --color-stone-900 (#1c1917) -->
    <meta
      name="theme-color"
      content="#1c1917"
      media="(prefers-color-scheme: dark)"
    />

    <style>
      /* Inter Font */
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap")
      layer;

      #dx-toast-template {
        display: none;
        visibility: hidden;
      }

      .dx-toast {
        position: absolute;
        top: 10px;
        right: 0;
        padding-right: 10px;
        user-select: none;
        /* transition: transform 0.2s ease; */
        z-index: 2147483647;
      }

      .dx-toast .dx-toast-inner {
        /* transition: right 0.2s ease-out; */
        position: fixed;

        background-color: #181b20;
        color: #ffffff;
        font-family: "Inter", sans-serif;

        display: grid;
        grid-template-columns: auto auto;
        max-width: 400px;
        min-height: 56px;
        border-radius: 5px;
      }

      .dx-toast .dx-toast-inner {
        cursor: pointer;
        margin-right: 10px;
      }

      .dx-toast .dx-toast-level-bar-container {
        height: 100%;
        width: 6px;
      }

      .dx-toast .dx-toast-level-bar-container .dx-toast-level-bar {
        width: 100%;
        height: 100%;
        border-radius: 5px 0px 0px 5px;
      }

      .dx-toast .dx-toast-content {
        padding: 8px;
      }

      .dx-toast .dx-toast-header {
        display: flex;
        flex-direction: row;
        justify-content: start;
        align-items: end;
        margin-bottom: 10px;
      }

      .dx-toast .dx-toast-header > svg {
        height: 18px;
        margin-right: 5px;
      }

      .dx-toast .dx-toast-header .dx-toast-header-text {
        font-size: 14px;
        font-weight: 700;
        padding: 0;
        margin: 0;
      }

      .dx-toast .dx-toast-msg {
        font-size: 11px;
        font-weight: 400;
        padding: 0;
        margin: 0;
      }

      .dx-toast-level-bar.info {
        background-color: #428eff;
      }

      .dx-toast-level-bar.success {
        background-color: #42ff65;
      }

      .dx-toast-level-bar.error {
        background-color: #ff4242;
      }
    </style>
    <script>
      const STORAGE_KEY = "SCHEDULED-DX-TOAST";
      let currentTimeout = null;
      let currentToastId = 0;

      // Show a toast, removing the previous one.
      function showDXToast(headerText, message, progressLevel, durationMs) {
        document.getElementById("__dx-toast-decor").className =
          `dx-toast-level-bar ${progressLevel}`;
        document.getElementById("__dx-toast-text").innerText = headerText;
        document.getElementById("__dx-toast-msg").innerText = message;
        document.getElementById("__dx-toast-inner").style.right = "0";
        const toastEl = document.getElementById("__dx-toast");
        toastEl.style.display = "";
        toastEl.removeAttribute("aria-hidden");
        toastEl.addEventListener("click", closeDXToast);

        // Wait a bit of time so animation plays correctly.
        setTimeout(() => {
          const ourToastId = currentToastId;
          currentTimeout = setTimeout(() => {
            if (ourToastId === currentToastId) {
              closeDXToast();
            }
          }, durationMs);
        }, 100);

        currentToastId += 1;
      }

      // Schedule a toast to be displayed after reload.
      function scheduleDXToast(headerText, message, level, durationMs) {
        const data = {
          headerText,
          message,
          level,
          durationMs,
        };

        const jsonData = JSON.stringify(data);
        sessionStorage.setItem(STORAGE_KEY, jsonData);
      }

      // Close the current toast.
      function closeDXToast() {
        document.getElementById("__dx-toast-inner").style.right = "-1000px";
        const toastEl = document.getElementById("__dx-toast");
        toastEl.style.display = "none";
        toastEl.setAttribute("aria-hidden", "true");

        clearTimeout(currentTimeout);
      }

      // Handle any scheduled toasts after reload.
      const potentialData = sessionStorage.getItem(STORAGE_KEY);
      if (potentialData) {
        sessionStorage.removeItem(STORAGE_KEY);
        const data = JSON.parse(potentialData);
        showDXToast(data.headerText, data.message, data.level, data.durationMs);
      }

      window.scheduleDXToast = scheduleDXToast;
      window.showDXToast = showDXToast;
      window.closeDXToast = closeDXToast;
    </script>
  </head>
  <body>
    <div
      id="__dx-toast"
      class="dx-toast"
      aria-hidden="true"
      style="display: none"
    >
      <div id="__dx-toast-inner" class="dx-toast-inner" style="right: -1000px">
        <div class="dx-toast-level-bar-container">
          <div id="__dx-toast-decor" class="dx-toast-level-bar __info"></div>
        </div>
        <div class="dx-toast-content">
          <div class="dx-toast-header">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 32 32"
              preserveAspectRatio="none"
            >
              <path
                d="M22.158 1.783c0 3.077-.851 5.482-2.215 7.377s-3.32 3.557-5.447 5.33-4.425 3.657-6.252 6.195-3.102 5.515-3.102 9.532h4.699c0-3.077.853-5.377 2.217-7.272s3.32-3.557 5.447-5.33 4.425-3.657 6.252-6.195 3.102-5.62 3.102-9.637z"
                fill="#e96020"
              />
              <path
                d="M9.531 25.927c-.635 0-1.021.515-1.02 1.15s.385 1.151 1.02 1.15H22.47a1.151 1.151 0 1 0 0-2.301zm1.361-4.076c-.608 0-.954.558-.953 1.166s.346 1.035.953 1.035h10.217a1.101 1.101 0 1 0 0-2.201zm0-13.594a1.101 1.101 0 1 0 0 2.201h10.217c.607 0 .953-.598.953-1.205s-.345-.996-.953-.996zM9.531 4.021A1.15 1.15 0 0 0 8.38 5.17a1.15 1.15 0 0 0 1.15 1.15h12.94c.635 0 1.021-.498 1.02-1.133s-.386-1.166-1.02-1.166z"
                fill="#2d323b"
              />
              <path
                d="M5.142 1.783c0 4.016 1.275 7.099 3.102 9.637s4.125 4.422 6.252 6.195 4.083 3.656 5.447 5.551 2.215 3.974 2.215 7.051h4.701c0-4.016-1.275-7.038-3.102-9.576s-4.125-4.422-6.252-6.195-4.083-3.435-5.447-5.33S9.841 4.86 9.841 1.783z"
                fill="#00a8d6"
              />
            </svg>
            <h3 id="__dx-toast-text" class="dx-toast-header-text">
              Your app is being rebuilt.
            </h3>
          </div>
          <p id="__dx-toast-msg" class="dx-toast-msg">
            A non-hot-reloadable change occurred and we must rebuild.
          </p>
        </div>
      </div>
    </div>
    <div id="main"></div>
  </body>
</html>
